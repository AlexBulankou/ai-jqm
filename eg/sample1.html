<!DOCTYPE html>
<html>
<head>
    <title>JQM with AppInsights Demo</title>
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <link rel="stylesheet" href="http://code.jquery.com/mobile/1.4.5/jquery.mobile-1.4.5.min.css" />
    <style type="text/css">
        #stock-price {
            font-size: 4em;
        }
    </style>
    <script src="http://code.jquery.com/jquery-1.11.1.min.js"></script>
    <script src="https://cdn.rawgit.com/azicchetti/jquerymobile-router/v0.93/js/jquery.mobile.router.js"></script>
    <script src="http://code.jquery.com/mobile/1.4.5/jquery.mobile-1.4.5.min.js"></script>

    <script type="text/javascript">
        var appInsights=window.appInsights||function(config){
            function r(config){t[config]=function(){var i=arguments;t.queue.push(function(){t[config].apply(t,i)})}}var t={config:config},u=document,e=window,o="script",s=u.createElement(o),i,f;for(s.src=config.url||"//az416426.vo.msecnd.net/scripts/a/ai.0.js",u.getElementsByTagName(o)[0].parentNode.appendChild(s),t.cookie=u.cookie,t.queue=[],i=["Event","Exception","Metric","PageView","Trace"];i.length;)r("track"+i.pop());return r("setAuthenticatedUserContext"),r("clearAuthenticatedUserContext"),config.disableExceptionTracking||(i="onerror",r("_"+i),f=e[i],e[i]=function(config,r,u,e,o){var s=f&&f(config,r,u,e,o);return s!==!0&&t["_"+i](config,r,u,e,o),s}),t
        }({
            instrumentationKey:"3978d426-d8b8-45c3-8cf4-3765011f92cf"
        });
        
        window.appInsights=appInsights;
        appInsights.trackPageView();
    </script>
    <script src="../scripts/ai-jqm.min.js"></script>

    <script type="text/javascript">
      $.mobile.urlHistory = {};
        window.router=new $.mobile.Router({   
              "#stock([?](\.+))?": { handler: function(type,args){
                  var stockSymbol = args[2].toUpperCase();
                   $("#stock-h1").html(stockSymbol);
                    $.ajax(
                        { 
                            url:"http://stocksrv.azurewebsites.net/api/stock/"+stockSymbol, 
                            success:function(data){
                            $("#stock-price").html(data[0].l_cur); 
                        } 
                        });
                    
                    console.log(stockSymbol);
           
          }, events: "s" }    
        }
        );
    </script
</head>

<body>
    <!-- Home page -->
    <div data-role="page" id="home">
        <div data-role="header">
      
            <h1>JQM with AppInsights Demo</h1>

        </div> 
        <!-- /header -->
        <div role="main" class="ui-content">
           
                <ul data-role="listview">
                    <li><a href="#stock?aapl">AAPL</a></li>
                    <li><a href="#stock?amzn">AMZN</a></li>
                    <li><a href="#stock?goog">GOOG</a></li>
                    <li><a href="#stock?fb">FB</a></li>
                    <li><a href="#stock?msft">MSFT</a></li>
                </ul>
           
          
            <div class="ui-body">
                <p>
                    <a href="#dlg" class="ui-shadow ui-btn ui-corner-all ui-btn-inline" data-transition="flip">Open dialog</a>
                </p>
            </div>
        </div>
        <!-- /content -->
    </div>
    <!-- /page -->


    <div data-role="page" id="stock">
        <div data-role="header" data-add-back-btn="true">
        
            <h1 id="stock-h1">...</h1>
        </div>
        <!-- /header -->
        <div role="main" class="ui-content">
           <div id="stock-price"></div>
        </div>
        <!-- /content -->
    </div>


    <div data-role="page" id="dlg">
        <div data-role="header">
            <h1>...</h1>
        </div>
        <!-- /header -->
        <div role="main" class="ui-content">
            <p><a href="#home">Back home</a></p>
        </div>
        <!-- /content -->
    </div>

</body>
</html>